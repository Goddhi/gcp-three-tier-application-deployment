# name: 'CI for frontend'

# on:
#   push: 
#     branches:
#     - main

# jobs:
#   build-frontend-image:
#     name: "build frontend image"
#     runs-on: 'ubuntu-latest'
  
#     steps:
#       - name: Checkout
#         uses: actions/checkout@v3

#       - name: sonarqubu-code-checkk
#         working-directory: End-to-End-Kubernetes-Three-Tier-DevSecOps-Project/Application-Code/frontend 
#         uses: sonarsource/sonarcloud-github-action@v1.1
#         env:
#           SONAR_HOST_URL: ${{ secrets.SONAR_SERVER_URL  }}
#           SONAR_TOKEN: ${{  secrets.SONAR.TOKEN  }}
#         with:
#           args: >
#             -Dsonar.projectKey=three-tier-frontend
#             -Dsonar.projectName=three-tier-frontend
#             -Dsonar.sources=Application-Code/frontend  # Specify the source directory
#             -Dsonar.host.url=${{ secrets.SONAR_HOST_URL }}
#             -Dsonar.login=${{ secrets.SONAR_TOKEN }}

      
name: 'CI for frontend'

on:
  push: 
    branches:
      - main

jobs:
  build-frontend-image:
    name: "Build Frontend Image"
    runs-on: ubuntu-latest
  
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Install Java 17
        run: sudo apt-get install -y openjdk-17-jdk

      - name: Set JAVA_HOME to Java 17
        run: echo "JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64" >> $GITHUB_ENV


      # Install SonarQube Scanner
      - name: Install SonarQube Scanner
        run: |
          sudo apt-get update
          sudo apt-get install -y wget unzip
          wget https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-4.6.2.2472-linux.zip
          unzip sonar-scanner-cli-4.6.2.2472-linux.zip -d $HOME
          echo "export PATH=$HOME/sonar-scanner-4.6.2.2472-linux/bin:$PATH" >> $HOME/.bashrc
          export PATH=$HOME/sonar-scanner-4.6.2.2472-linux/bin:$PATH
          
          # Verify installation
          $HOME/sonar-scanner-4.6.2.2472-linux/bin/sonar-scanner --version

      # Run SonarQube Scan
      - name: SonarQube Scan
        run: |
          $HOME/sonar-scanner-4.6.2.2472-linux/bin/sonar-scanner \
            -Dsonar.projectKey=three-tier-frontend \
            -Dsonar.projectName=three-tier-frontend \
            -Dsonar.sources=Application-Code/frontend \
            -Dsonar.host.url=${{ secrets.SONAR_SERVER_URL }} \
            -Dsonar.login=${{ secrets.SONAR_TOKEN }}
        env:
          SONAR_HOST_URL: ${{ secrets.SONAR_SERVER_URL }}
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}


        